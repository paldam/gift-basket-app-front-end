
<button  *ngIf="this.isCurrentPageOrdersViewRedirectedFromBasketStatitis" (click)="backToRegularOrderView()" class="btn bg-primary" type="button"> Czyść </button>
<button *ngIf="this.isCurrentPageOrdersViewRedirectedFromBasketStatitis" (click)="backToBasketStatistic()" class="btn bg-primary" type="button"> Powrót do statystyki koszy koszy </button>
<div class="products_box">

    <div  class="input-group search_bar" >
            <span class="input-group-addon" id="basic-addon1">
                 <i class="fa fa-search" aria-hidden="true"></i>
            </span>
        <input #globalfilter type="text"  class="form-control search_input" pInputText size="50" placeholder="Szukaj"aria-describedby="basic-addon1" [(ngModel)]="findInputTextOnOrderViewPage">




        <div class="onlyWithAttach form-check">
            <label class="form-check-label">
                <input  #onlyWithAttach type="checkbox" class="form-check-input" name=""  (click)="clickOnlyWithAtttach()" >
                Tylko z załącznikami
            </label>
        </div>


        <i class="fa fa-refresh pull-right refresh_icon fa-2x" aria-hidden="true" (click)="refreshData()"></i>


    </div>



    <p-dataTable #dt [value]="orders" [rows]="50" [paginator]="true" [globalFilter]="globalfilter"  [totalRecords]="totalRecords" selectionMode="multiple"
                 [loading]="loading" loadingIcon="fa-circle-o-notch" expandableRows="true" [(first)]="lastPaginationPageNumberOnOrderViewPage"  [(selection)]="selectedOrdersMultiselction"
                 dataKey="orderId" [contextMenu]="cm" [paginator]="true" [pageLinks]="5" [rowsPerPageOptions]= paginatorValues [lazy]="!isCurrentPageOrdersViewRedirectedFromBasketStatitis && !this.isCurrentPageCustomerEdit"
                 (onContextMenuSelect)="OnSelectRow($event)"
                 (onRowExpand)="rowExpand($event)"
                 (onPage)="hideActionExtention2($event)"
                 (onSort)="hideActionExtention2($event)"
                 (onFilter)="hideActionExtention2($event)"
                 (onRowDblclick)="showOrderPreview($event)"
                 (onRowClick)="hideActionExtention($event); getOrderFromRow($event)"
                 (onLazyLoad)="loadOrdersLazy($event)"
    >

        <p-header>Lista Zamówień</p-header>
        <p-column expander="true" header="" styleClass="col-icon " [style]="{'width':'40px'}"></p-column>


        <p-column field="orderFvNumber" header="Numer FV"  [style]="{'width':'90px'}"></p-column>




        <p-column field="orderDate" header="Data zamówienia" [style]="{'width':'140px', 'text-align':'center'}" [sortable]="true" [filter]="!this.isCurrentPageCustomerEdit" filterMatchMode="equals">

            <ng-template *ngIf="!this.isCurrentPageCustomerEdit" let-col pTemplate="filter"  >
                <div>
                    <p-multiSelect *ngIf="!this.isCurrentPageOrdersViewRedirectedFromBasketStatitis" [filter]="false" [showToggleAll]="false" [options]="ordersYears" defaultLabel="Wszystkie" (onChange)="datatable.filter($event.value, col.field, 'in')"></p-multiSelect>
                </div>

            </ng-template>

            <ng-template let-row="rowData" pTemplate="body"  >
                {{row.orderDate| date: 'dd/MM/yyyy HH:mm:ss'}}
            </ng-template>
        </p-column>





        <p-column field="customer.customerName" header="Nabywca" >
            <ng-template let-row="rowData" pTemplate="body"  >
                {{row.customer.name}} | {{row.customer.company?.companyName}}
            </ng-template>
        </p-column>

        <!--Hide columns, only to global search purpose-->
        <p-column field="customer.name" header=""  hidden="true"></p-column>
        <p-column field="customer.company.companyName" header=""  hidden="true"></p-column>




        <p-column field="additionalInformation" header="Dodatkowe informacje" >
            <ng-template let-row="rowData" pTemplate="body" >

                
                <span *ngIf="!isLongCell(row.additionalInformation)">
                    {{row.additionalInformation}}
                </span>
                <span pTooltip="dsadassd" *ngIf="isLongCell(row.additionalInformation)" (click)="showAdditionalIInfExtension($event,row.additionalInformation)">
                    {{row.additionalInformation| slice:0:90}}... <i class="fa fa-bolt " aria-hidden="true"></i>

                </span>
            </ng-template>
        </p-column>


        <p-column  field="deliveryDate" header="Data dostawy" [style]="{'width':'85px', 'text-align':'center'}" [sortable]="true">
            <ng-template let-row="rowData" pTemplate="body"  >
            {{row.deliveryDate| date: 'dd/MM/yyyy'}}
            </ng-template>
        </p-column>


        <p-column [styleClass]="'removable-col'" field="productionUser.login" header="Produkcja" [style]="{'width':'60px', 'text-align':'center'}" ></p-column>



        <p-column [styleClass]="'removable-col'" field="weekOfYear" header="T" [sortable]="true"  [style]="{'width':'35px', 'text-align':'center'}" ></p-column>

        <p-column field="orderTotalAmount" header="total" [style]="{'width':'90px', 'text-align':'center'}" [sortable]="true">
            <ng-template let-row="rowData" pTemplate="body"  >
                {{row.orderTotalAmount/100 | number : '1.2-2'}} zł
            </ng-template>
        </p-column>


        <p-column field="orderStatus.orderStatusName" header="Status" [style]="{'width':'150px', 'text-align':'center'}" [filter]="!this.isCurrentPageCustomerEdit" filterMatchMode="equals" [sortable]="true" >

            <ng-template *ngIf="!this.isCurrentPageCustomerEdit" let-col pTemplate="filter"  >
                <p-multiSelect *ngIf="!this.isCurrentPageOrdersViewRedirectedFromBasketStatitis" [filter]="false" [showToggleAll]="false" [options]="orderStatusList" defaultLabel="Wszystkie" (onChange)="datatable.filter($event.value, col.field, 'in')"></p-multiSelect>
            </ng-template>

            <ng-template let-row="rowData" pTemplate="body"  >

                <span *ngIf="row.orderStatus.orderStatusId == 6 && isCurrentPageOrdersView" ><p-progressBar [ngClass]="{'progressbar-color-green': value < 50, 'progressbar-color-red': value > 50}"   [value]="row.progress"></p-progressBar></span>
                <span *ngIf="row.orderStatus.orderStatusId != 6 || !isCurrentPageOrdersView" [ngStyle]="calculateStyles(row.orderStatus.orderStatusName)">{{row.orderStatus.orderStatusName }}</span>
            </ng-template>

        </p-column>



        <p-column  [styleClass]="'removable-col'" field="deliveryType.deliveryTypeName" header="Rodzaj dostawy" [style]="{'width':'130px', 'text-align':'center'}"></p-column>


        <p-column [styleClass]="'removable-col2'"class="attach_col" field="dbFileId"   [sortable]="false" header="Z" [style]="{'width':'28px'}">
            <ng-template let-row="rowData"  pTemplate="body">

                <span *ngIf="row.dbFileId!=0"> <i class="fa  fa-paperclip" aria-hidden="true"></i></span>
            </ng-template>
        </p-column>

        <p-column [styleClass]="'removable-col2'" class="attach_col" field="additionalSale"   [sortable]="true" header="D" [style]="{'width':'28px'}">
            <ng-template let-row="rowData"  pTemplate="body">

                <span *ngIf="row.additionalSale==1"> <i class="fa fa-check" aria-hidden="true"></i></span>
            </ng-template>
        </p-column>


        <p-column class="action_col"  field="orders" header="Akcja" [style]="{'width':'40px'}">
        <ng-template let-order="rowData" let-i="rowIndex" pTemplate="body">
            <i id="action_extention_icon" class="fa fa-cog fa-2x " aria-hidden="true"  title="Edytuj zamówienie"   (click)="showActionExtention($event)"></i>
        </ng-template>
    </p-column>


        <ng-template let-orders pTemplate="rowexpansion">
            <p>Pozycje zamówienia</p>
            <div class="d-table-wrapper">
                <table class="d-table">
                    <colgroup>
                        <col span="1" style="width: 60%;">
                        <col span="1" style="width: 10%;">
                        <col span="1" style="width: 10%;">
                        <col span="1" style="width: 10%;">
                        <col span="1" style="width: 10%;">
                    </colgroup>
                    <thead>
                    <tr >
                        <th >Nazwa kosza</th>
                        <th >illość</th>
                        <th >Produkcja</th>
                        <th >Magazyn</th>
                        <th >Logistyka</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr  *ngFor="let i of orders.orderItems">
                        <td >{{i.basket.basketName}}</td>
                        <td>{{i.quantity}}</td>
                        <td>
                            <input type="number" class="form-control" name="" id="" aria-describedby="helpId" placeholder="" min="0" [max]="i.quantity" [value]="i.stateOnProduction" (change)="updateStatusState()">
                        </td>
                        <td>
                            <input type="number" class="form-control" name="" id="" aria-describedby="helpId" placeholder="" min="0" [max]="i.quantity" [value]="i.stateOnWarehouse" (change)="updateStatusState()">
                        </td>
                        <td>
                            <input type="number" class="form-control" name="" id="" aria-describedby="helpId" placeholder="" min="0" [max]="i.quantity" [value]="i.stateOnLogistics" (change)="updateStatusState()">
                        </td>
                    </tr>
                    </tbody>
                </table>
                <button class="btn bg-primary change-state-btn " >Aktualizuj</button>

            </div>




        </ng-template>
    </p-dataTable>
</div>


<p-confirmDialog header="Usuwanie produktu" icon="fa fa-question-circle" width="425"></p-confirmDialog>




<p-dialog header="Wybierz pozycje do wydruku:" closeOnEscape="false" modal="true" width="600" [(visible)]="printDeliveryConfirmationPdFSettings"  >
    <p-dataTable [value]="selectedToPrintOrder.orderItems" [rows]="20"   [paginator]="true"  #dt [loading]="loading" loadingIcon="fa-circle-o-notch"  >
        <p-column field="basket.basketName" styleClass="nazwa" header="Nazwa kosza"></p-column>
        <p-column field="quantity"   styleClass="quantity_col" header="Ilość"   >
            <ng-template let-row="rowData" pTemplate="body" type="number">
                <p-spinner size="4" [(ngModel)]="row.quantity" [min]="0"></p-spinner>
            </ng-template>
        </p-column>
    </p-dataTable>

    <button type="button" (click)="printConfirmationPdf()" class="btn btn-primary"> Drukuj potwierzenie</button>
</p-dialog>







<p-dialog *ngIf="isOrderToPrintProductOfBasketsFetchComplete | async" header="Wybierz kosze do wydrukowania:" closeOnEscape="false" modal="true" width="600" [(visible)]="pdialogBasketProductsPrint"  >
    <p-dataTable [value]="selectedOrderToPrintBasketProducts.orderItems" [rows]="20"   [paginator]="true"  #dt [loading]="loading" loadingIcon="fa-circle-o-notch"  >
        <p-column field="basket.basketName" styleClass="nazwa" header="Nazwa kosza"></p-column>
        <p-column field="quantity" styleClass="nazwa" header="Ilość"></p-column>
        <p-column    styleClass="quantity_col" header="Wydrukować ?"   >
            <ng-template let-row="rowData" pTemplate="body" type="number">
                <p-checkbox [(ngModel)]="row.added" binary="true"></p-checkbox>
            </ng-template>
        </p-column>
    </p-dataTable>

    <button type="button" (click)="printOrderBasketsProductsPdf()" class="btn btn-primary"> Drukuj zestawienie koszy</button>
</p-dialog>







<p-dialog *ngIf="isOrderToShowFetchComplete | async" header="Podgląd Zamówienia" closeOnEscape="false" modal="true" width="600" [(visible)]="showOrderPreviewModal"  >


   <app-order-preview [orderToShow]="selectedToPrintOrder"> </app-order-preview>

</p-dialog>


<p-dialog *ngIf="fileFilterLoaded | async" header="Podgląd załączników do zamówienia" closeOnEscape="false" modal="true" width="600" [(visible)]="showAttachmentModal"  >


    <p *ngIf="selectedOrderFileList.length ==0"> Brak załączników dla tego zamówienia</p>

    <table >
        <thead>
        </thead>
        <tbody>
        <tr class="fileLink"  *ngFor="let item of selectedOrderFileList" >
            <td class="fileprev" (click)="getFile(item.fileId)" ><i class="fa fa-file-text-o" aria-hidden="true"></i>  {{item.fileName}}</td>
            <!--<td *ngIf="authenticationService.isAdmin() || authenticationService.isBiuroUser()"> <i (click)="ShowConfirmModal(item)" class="fa fa-trash"></i></td>-->
        </tr>
        </tbody>
    </table>

</p-dialog>







<p-contextMenu #cm [model]="items"> </p-contextMenu>

<p-overlayPanel #information_extention  >
    {{additionalInforamtionTmp}}
</p-overlayPanel>



<div #action_extention  [hidden]="true" class="action_extention" [style.top.px]="actionExtentionPositionTop" [style.left.px]="actionExtentionPositionLeft">
    <div class="cont2">
        <i [ngClass]="notAllowedStyle()" class="fa fa-pencil-square-o fa-2x famargin2 action_extention_icon" aria-hidden="true"  title="Edytuj zamówienie" (click)="goToEditPage(selectedOrderFromRow.orderId)"></i>
        <i *ngIf="authenticationService.isAdmin()" class="fa fa-trash fa-2x edit_icon famargin2 action_extention_icon" aria-hidden="true" title="Usuń zamówienie" (click)="ShowConfirmModal(selectedOrderFromRow)"></i>
        <i  class="fa fa-print fa-2x famargin2 action_extention_icon " aria-hidden="true" title="Drukuj zamówienie" (click)="printPdf(selectedOrderFromRow.orderId)" ></i>
        <i  class="fa fa-file-pdf-o fa-2x  famargin2 action_extention_icon" aria-hidden="true" title="Drukuj potwierdzenie odbioru" (click)="showPrintOrderDeliveryConfirmationWindows(selectedOrderFromRow.orderId)" ></i>
        <i  class="fa fa-file-text fa-2x famargin2 action_extention_icon" aria-hidden="true" title="Drukuj kompletna listę produktów zamówienia" (click)=" printProductListPdf(selectedOrderFromRow.orderId)" ></i>
        <i  class="fa fa-file-text-o fa-2x fa_zero_margin action_extention_icon" aria-hidden="true" title="Drukuj dostosowana liste produktów zamówienia" (click)=" showPdialogBasketProductsPrint(selectedOrderFromRow.orderId)" ></i>
    </div>

</div>
